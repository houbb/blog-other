import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,a,o as i}from"./app-CEDSurVN.js";const p={};function o(r,e){return i(),n("div",null,e[0]||(e[0]=[a(`<h1 id="zookeeper审核日志" tabindex="-1"><a class="header-anchor" href="#zookeeper审核日志"><span>ZooKeeper审核日志</span></a></h1><p>Apache ZooKeeper支持3.6.0版以上的审核日志。</p><p>默认情况下，审核日志处于禁用状态。</p><p>要启用审核日志，请在conf/zoo.cfg中配置audit.enable = true。</p><p>审核日志并非记录在所有的ZooKeeper服务器上，而是仅记录在连接客户端的服务器上，如下图所示。</p><figure><img src="https://zookeeper.apache.org/doc/r3.6.2/images/zkAuditLogs.jpg" alt="zkAuditLogs" tabindex="0" loading="lazy"><figcaption>zkAuditLogs</figcaption></figure><p>审核日志捕获有关选择要审核的操作的详细信息。</p><p>审核信息被编写为以下键的一组键=值对</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>Key	    Value</span></span>
<span class="line"><span>session	客户端会话ID</span></span>
<span class="line"><span>user	逗号分隔的与客户端会话相关联的用户列表。 有关更多信息，请参阅在审核日志中将谁作为用户。</span></span>
<span class="line"><span>ip	客户端IP地址</span></span>
<span class="line"><span>operation	所选的任何一项操作以进行审核。 可能的值为（serverStart，serverStop，创建，删除，setData，setAcl，multiOperation，reconfig，ephemeralZNodeDeleteOnSessionClose）</span></span>
<span class="line"><span>znode	znode路径</span></span>
<span class="line"><span>znode type	操作时的znode类型znode类型</span></span>
<span class="line"><span>acl	znode ACL的字符串表示形式，如cdrwa（创建，删除，读取，写入，管理）。 仅记录setAcl操作</span></span>
<span class="line"><span>result	可能的值为（成功/失败/调用）。 结果“已调用”用于serverStop操作，因为在确保服务器实际停止之前已记录了stop。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>比如下面的例子：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>user=zookeeper/192.168.1.3 operation=serverStart   result=success</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=create    znode=/a    znode_type=persistent  result=success</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=create    znode=/a    znode_type=persistent  result=failure</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=setData   znode=/a    result=failure</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=setData   znode=/a    result=success</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=setAcl    znode=/a    acl=world:anyone:cdrwa  result=failure</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=setAcl    znode=/a    acl=world:anyone:cdrwa  result=success</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=create    znode=/b    znode_type=persistent  result=success</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=setData   znode=/b    result=success</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=delete    znode=/b    result=success</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=multiOperation    result=failure</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=delete    znode=/a    result=failure</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=delete    znode=/a    result=success</span></span>
<span class="line"><span>session=0x19344730001   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=create   znode=/ephemral znode_type=ephemral result=success</span></span>
<span class="line"><span>session=0x19344730001   user=zookeeper/192.168.1.3   operation=ephemeralZNodeDeletionOnSessionCloseOrExpire  znode=/ephemral result=success</span></span>
<span class="line"><span>session=0x19344730000   user=192.168.1.2,zkcli@HADOOP.COM  ip=192.168.1.2    operation=reconfig  znode=/zookeeper/config result=success</span></span>
<span class="line"><span>user=zookeeper/192.168.1.3 operation=serverStop    result=invoked</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="zookeeper审核日志配置" tabindex="-1"><a class="header-anchor" href="#zookeeper审核日志配置"><span>ZooKeeper审核日志配置</span></a></h1><p>默认情况下，审核日志处于禁用状态。</p><p>要启用审核日志，请在conf / zoo.cfg中配置audit.enable = true。</p><p>审核日志记录使用log4j完成。</p><p>以下是conf / log4j.properties中审核日志的默认log4j配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#</span></span>
<span class="line"><span># zk audit logging</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>zookeeper.auditlog.file=zookeeper_audit.log</span></span>
<span class="line"><span>zookeeper.auditlog.threshold=INFO</span></span>
<span class="line"><span>audit.logger=INFO, RFAAUDIT</span></span>
<span class="line"><span>log4j.logger.org.apache.zookeeper.audit.Log4jAuditLogger=\${audit.logger}</span></span>
<span class="line"><span>log4j.additivity.org.apache.zookeeper.audit.Log4jAuditLogger=false</span></span>
<span class="line"><span>log4j.appender.RFAAUDIT=org.apache.log4j.RollingFileAppender</span></span>
<span class="line"><span>log4j.appender.RFAAUDIT.File=\${zookeeper.log.dir}/\${zookeeper.auditlog.file}</span></span>
<span class="line"><span>log4j.appender.RFAAUDIT.layout=org.apache.log4j.PatternLayout</span></span>
<span class="line"><span>log4j.appender.RFAAUDIT.layout.ConversionPattern=%d{ISO8601} %p %c{2}: %m%n</span></span>
<span class="line"><span>log4j.appender.RFAAUDIT.Threshold=\${zookeeper.auditlog.threshold}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Max log file size of 10MB</span></span>
<span class="line"><span>log4j.appender.RFAAUDIT.MaxFileSize=10MB</span></span>
<span class="line"><span>log4j.appender.RFAAUDIT.MaxBackupIndex=10</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="谁是审核日志中的用户" tabindex="-1"><a class="header-anchor" href="#谁是审核日志中的用户"><span>谁是审核日志中的用户？</span></a></h1><p>默认情况下，只有四个身份验证提供程序：</p><ul><li><p>IP认证提供者</p></li><li><p>SASLAuthenticationProvider</p></li><li><p>X509AuthenticationProvider</p></li><li><p>DigestAuthenticationProvider</p></li></ul><p>根据配置的身份验证提供程序确定用户：</p><ul><li><p>配置IPAuthenticationProvider后，将经过身份验证的IP用作用户</p></li><li><p>配置SASLAuthenticationProvider时，将客户端主体作为用户</p></li><li><p>配置X509AuthenticationProvider时，将客户端证书作为用户</p></li><li><p>配置DigestAuthenticationProvider时，经过身份验证的用户为user</p></li></ul><p>自定义身份验证提供程序可以重写org.apache.zookeeper.server.auth.AuthenticationProvider.getUserName（String id）以提供用户名。</p><p>如果身份验证提供程序未覆盖此方法，则将org.apache.zookeeper.data.Id.id中存储的内容作为用户。</p><p>通常，只有用户名存储在此字段中，但是取决于用户身份验证提供者存储在其中的内容。对于审核日志记录，将org.apache.zookeeper.data.Id.id的值作为用户。</p><p>在ZooKeeper服务器中，并非所有操作都由客户端完成，而是某些操作由服务器本身完成。</p><p>例如，当客户端关闭会话时，临时znode将被服务器删除。这些删除操作不是由客户端直接完成的，而是由服务器本身完成的，这些操作称为系统操作。对于这些系统操作，在审核记录这些操作时，会将与ZooKeeper服务器关联的用户视为用户。</p><p>例如，如果在ZooKeeper中，服务器主体是zookeeper/hadoop.hadoop.com@HADOOP.COM，则它将成为系统用户，并且所有系统操作都将使用该用户名记录。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>user=zookeeper/hadoop.hadoop.com@HADOOP.COM operation=serverStart result=success</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果没有与ZooKeeper服务器关联的用户，则将启动ZooKeeper服务器的用户视为该用户。例如，如果服务器由root启动，则将root作为系统用户</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>user=root operation=serverStart result=success</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>单个客户端可以将多个身份验证方案附加到会话，在这种情况下，所有身份验证方案都将以用户身份使用，并以逗号分隔的列表形式显示。例如，如果客户端通过主体zkcli@HADOOP.COM和ip 127.0.0.1进行身份验证，则创建znode审核日志将如下所示：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>session=0x10c0bcb0000 user=zkcli@HADOOP.COM,127.0.0.1 ip=127.0.0.1 operation=create znode=/a result=success</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料"><span>参考资料</span></a></h1><p><a href="https://zookeeper.apache.org/doc/r3.6.2/zookeeperAuditLogs.html" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.6.2/zookeeperAuditLogs.html</a></p>`,35)]))}const d=s(p,[["render",o]]),c=JSON.parse('{"path":"/posts/zookeeper/2016-09-25-zookeeper-12-aduit-logs.html","title":"ZooKeeper-12-aduit logs","lang":"zh-CN","frontmatter":{"title":"ZooKeeper-12-aduit logs","date":"2016-09-25T00:00:00.000Z","categories":["Apache"],"tags":["zookeeper","config-center"],"published":true,"description":"ZooKeeper审核日志 Apache ZooKeeper支持3.6.0版以上的审核日志。 默认情况下，审核日志处于禁用状态。 要启用审核日志，请在conf/zoo.cfg中配置audit.enable = true。 审核日志并非记录在所有的ZooKeeper服务器上，而是仅记录在连接客户端的服务器上，如下图所示。 zkAuditLogszkAud...","head":[["meta",{"property":"og:url","content":"https://houbb.github.io/blog-other/posts/zookeeper/2016-09-25-zookeeper-12-aduit-logs.html"}],["meta",{"property":"og:site_name","content":"老马啸西风"}],["meta",{"property":"og:title","content":"ZooKeeper-12-aduit logs"}],["meta",{"property":"og:description","content":"ZooKeeper审核日志 Apache ZooKeeper支持3.6.0版以上的审核日志。 默认情况下，审核日志处于禁用状态。 要启用审核日志，请在conf/zoo.cfg中配置audit.enable = true。 审核日志并非记录在所有的ZooKeeper服务器上，而是仅记录在连接客户端的服务器上，如下图所示。 zkAuditLogszkAud..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://zookeeper.apache.org/doc/r3.6.2/images/zkAuditLogs.jpg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-22T03:45:14.000Z"}],["meta",{"property":"article:tag","content":"zookeeper"}],["meta",{"property":"article:tag","content":"config-center"}],["meta",{"property":"article:published_time","content":"2016-09-25T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-22T03:45:14.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ZooKeeper-12-aduit logs\\",\\"image\\":[\\"https://zookeeper.apache.org/doc/r3.6.2/images/zkAuditLogs.jpg\\"],\\"datePublished\\":\\"2016-09-25T00:00:00.000Z\\",\\"dateModified\\":\\"2025-08-22T03:45:14.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"老马啸西风\\",\\"url\\":\\"https://houbb.github.io\\"}]}"]]},"git":{"createdTime":1755834314000,"updatedTime":1755834314000,"contributors":[{"name":"binbin.hou","username":"","email":"binbin.hou@huifu.com","commits":1}]},"readingTime":{"minutes":4.04,"words":1211},"filePathRelative":"posts/zookeeper/2016-09-25-zookeeper-12-aduit-logs.md","localizedDate":"2016年9月25日","excerpt":"\\n<p>Apache ZooKeeper支持3.6.0版以上的审核日志。</p>\\n<p>默认情况下，审核日志处于禁用状态。</p>\\n<p>要启用审核日志，请在conf/zoo.cfg中配置audit.enable = true。</p>\\n<p>审核日志并非记录在所有的ZooKeeper服务器上，而是仅记录在连接客户端的服务器上，如下图所示。</p>\\n<figure><img src=\\"https://zookeeper.apache.org/doc/r3.6.2/images/zkAuditLogs.jpg\\" alt=\\"zkAuditLogs\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>zkAuditLogs</figcaption></figure>","autoDesc":true}');export{d as comp,c as data};
