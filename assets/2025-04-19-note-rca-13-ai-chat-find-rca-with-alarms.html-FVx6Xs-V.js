import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as t}from"./app-uJE4P3e0.js";const e={};function l(h,s){return t(),a("div",null,s[0]||(s[0]=[n(`<h1 id="序言" tabindex="-1"><a class="header-anchor" href="#序言"><span>序言</span></a></h1><p>结合 ai 打造 rca 系统，先让 ai 回答一下。</p><h1 id="chat" tabindex="-1"><a class="header-anchor" href="#chat"><span>chat</span></a></h1><h2 id="你是一名监控报警-运维的资深架构师-经验丰富-知识跨多个领域。性格严谨、理性。简单起见-我们先从一段时间内的多个报警出发-如何推断出当前问题的根因-要求-top3-并且准确性尽可能的高" tabindex="-1"><a class="header-anchor" href="#你是一名监控报警-运维的资深架构师-经验丰富-知识跨多个领域。性格严谨、理性。简单起见-我们先从一段时间内的多个报警出发-如何推断出当前问题的根因-要求-top3-并且准确性尽可能的高"><span>你是一名监控报警+运维的资深架构师，经验丰富，知识跨多个领域。性格严谨、理性。简单起见，我们先从一段时间内的多个报警出发，如何推断出当前问题的根因？要求 top3，并且准确性尽可能的高</span></a></h2><p>非常好，<strong>从一段时间内的多个报警出发，推断当前问题的根因</strong>，这是 AI 根因分析系统中最关键、最具挑战性的场景。</p><p>我会以你要求的风格：<strong>专业、理性、高准确率优先</strong>，不浮夸，强调严谨性。</p><hr><h2 id="🎯-场景目标" tabindex="-1"><a class="header-anchor" href="#🎯-场景目标"><span>🎯 场景目标</span></a></h2><blockquote><p>✅ <strong>输入</strong>：一个时间窗口内的多条报警（不同组件、主机、服务、级别）<br> ✅ <strong>输出</strong>：排序后的 <strong>Top 3 根因候选</strong>，附带推理路径和置信评分</p></blockquote><hr><h2 id="🧱-解决方案核心思路-以图驱动的根因推断" tabindex="-1"><a class="header-anchor" href="#🧱-解决方案核心思路-以图驱动的根因推断"><span>🧱 解决方案核心思路：以图驱动的根因推断</span></a></h2><p>我们可以抽象出以下分析步骤：</p><h3 id="_1-多报警事件归一建模" tabindex="-1"><a class="header-anchor" href="#_1-多报警事件归一建模"><span><strong>1. 多报警事件归一建模</strong></span></a></h3><h3 id="_2-构建报警传播图-因果-依赖图" tabindex="-1"><a class="header-anchor" href="#_2-构建报警传播图-因果-依赖图"><span><strong>2. 构建报警传播图（因果/依赖图）</strong></span></a></h3><h3 id="_3-进行根因评分计算-结合指标、日志、trace" tabindex="-1"><a class="header-anchor" href="#_3-进行根因评分计算-结合指标、日志、trace"><span><strong>3. 进行根因评分计算（结合指标、日志、Trace）</strong></span></a></h3><h3 id="_4-输出-top-3-根因候选-推理路径-打分" tabindex="-1"><a class="header-anchor" href="#_4-输出-top-3-根因候选-推理路径-打分"><span><strong>4. 输出 Top 3 根因候选 + 推理路径 + 打分</strong></span></a></h3><hr><h2 id="📌-step-1-多报警标准化建模" tabindex="-1"><a class="header-anchor" href="#📌-step-1-多报警标准化建模"><span>📌 Step 1：多报警标准化建模</span></a></h2><p>将每条报警统一转换为结构化格式：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;timestamp&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;2025-08-07T09:00:00&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;host&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;node-a&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;service&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;payment-service&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;metric&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;latency_p99&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;value&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;2500ms&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;severity&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;critical&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;延迟超过阈值&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在一个时间窗内（如5分钟），我们收集所有告警，形成一个“报警事件集”。</p><hr><h2 id="📌-step-2-构建告警传播图-alert-graph" tabindex="-1"><a class="header-anchor" href="#📌-step-2-构建告警传播图-alert-graph"><span>📌 Step 2：构建告警传播图（Alert Graph）</span></a></h2><blockquote><p>类似调用链拓扑，但这里我们构造一个<strong>报警因果图</strong>或称为<strong>传播图</strong>，通过依赖 + 时间 +传播方向 构建节点间关系。</p></blockquote><ul><li>节点 = 每条报警（带上下文）</li><li>边 = 依赖关系（如服务 A 调用服务 B）</li><li>属性 = 告警时间、指标波动、日志异常、Trace延迟</li></ul><p>示意：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>A (error) → B (延迟) → C (降级)</span></span>
<span class="line"><span>         ↘ D (QPS下降)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>此时构建出报警传播图后，就可以做“根因评分”。</p><hr><h2 id="📌-step-3-根因候选打分-rca-scoring" tabindex="-1"><a class="header-anchor" href="#📌-step-3-根因候选打分-rca-scoring"><span>📌 Step 3：根因候选打分（RCA Scoring）</span></a></h2><p>为每个节点（报警）评估其成为「根因」的可能性，基于以下打分机制：</p><table><thead><tr><th>维度</th><th>含义</th><th>分值建议</th></tr></thead><tbody><tr><td>📍 异常源评分</td><td>是否为拓扑叶子节点；传播链起点</td><td>+0.2~0.3</td></tr><tr><td>⏱ 时间优先评分</td><td>最早触发报警（先于其他依赖）</td><td>+0.1~0.2</td></tr><tr><td>📊 指标剧烈变动</td><td>指标突变严重程度（如错误率&gt;50%）</td><td>+0.1~0.3</td></tr><tr><td>🧾 日志证据</td><td>是否有明确的异常日志/关键词命中</td><td>+0.2~0.4</td></tr><tr><td>🧠 Trace 定位</td><td>Trace中是否为瓶颈Span（&gt;80%耗时）</td><td>+0.2~0.4</td></tr><tr><td>🔁 上游是否正常</td><td>如果下游报警但上游无异常，怀疑根因在下游</td><td>+0.2</td></tr></tbody></table><p>加权计算每个节点的根因概率分数 <code>score(node_i)</code>，输出 Top 3 分数最高者。</p><hr><h2 id="📌-step-4-输出结构化推理结果-top3" tabindex="-1"><a class="header-anchor" href="#📌-step-4-输出结构化推理结果-top3"><span>📌 Step 4：输出结构化推理结果（Top3）</span></a></h2><p>示例输出如下：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;top3_root_causes&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;service&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;mysql&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;score&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.91</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;reasoning&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;最早触发报警：08:32:01&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;错误率高达35%，明显异常&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;payment-service日志显示：connect mysql timeout&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;Trace中此节点耗时占整链 85%&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      ],</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;suggestion&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;检查数据库连接池、网络或数据库状态&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;service&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;payment-service&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;score&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.78</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;reasoning&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;延迟升高，但下游 mysql 异常更加严重&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;Trace显示 payment 调用 mysql 耗时过长&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;属于受影响而非根因&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;service&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;order-service&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;score&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.56</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      &quot;reasoning&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;受 payment-service 异常传导影响&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &quot;自身指标无明显异常&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="📊-root-cause-scoring-公式建议-可配置" tabindex="-1"><a class="header-anchor" href="#📊-root-cause-scoring-公式建议-可配置"><span>📊 Root Cause Scoring 公式建议（可配置）</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>score = </span></span>
<span class="line"><span>  0.25 * topology_rootness     // 是否在传播链尾</span></span>
<span class="line"><span>+ 0.20 * early_alarm_factor     // 是否最先报警</span></span>
<span class="line"><span>+ 0.20 * metrics_severity       // 异常幅度</span></span>
<span class="line"><span>+ 0.25 * log_anomaly_score      // 日志异常分</span></span>
<span class="line"><span>+ 0.10 * trace_bottleneck_score // Trace 耗时</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="🔁-后续闭环反馈-增强准确率" tabindex="-1"><a class="header-anchor" href="#🔁-后续闭环反馈-增强准确率"><span>🔁 后续闭环反馈（增强准确率）</span></a></h2><p>每次输出后允许人工确认 + 反馈，闭环机制包括：</p><ol><li><strong>人工标注根因</strong>：用于监督训练或校验</li><li><strong>LLM提示修正增强</strong>：对错误分析可修正提示模板</li><li><strong>知识库补充</strong>：新增“mysql连接超时”的案例供下次使用（RAG）</li></ol><hr><h2 id="🧠-示例总结-简洁场景复盘" tabindex="-1"><a class="header-anchor" href="#🧠-示例总结-简洁场景复盘"><span>🧠 示例总结（简洁场景复盘）</span></a></h2><p><strong>输入报警列表：</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>[08:32] payment-service 错误率升高 &gt; 20%</span></span>
<span class="line"><span>[08:33] order-service 延迟 &gt; 2s</span></span>
<span class="line"><span>[08:34] mysql 错误日志：“connection timeout”</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>分析结果：</strong></p><ul><li><p>根因候选：</p><ol><li><code>mysql</code>（score: 0.91）✅</li><li><code>payment-service</code>（score: 0.78）</li><li><code>order-service</code>（score: 0.56）</li></ol></li><li><p>推理链条清晰</p></li><li><p>可配置评分逻辑</p></li><li><p>可反馈修正</p></li></ul><hr><h2 id="✅-最小可用闭环系统建议-mvp" tabindex="-1"><a class="header-anchor" href="#✅-最小可用闭环系统建议-mvp"><span>✅ 最小可用闭环系统建议（MVP）</span></a></h2><p>如果你希望快速落地一个最小可用闭环系统，可以这样：</p><table><thead><tr><th>模块</th><th>技术实现建议</th></tr></thead><tbody><tr><td>告警接收</td><td>Prometheus + Alertmanager Webhook</td></tr><tr><td>数据聚合</td><td>Kafka + Loki + PromQL + Trace 接口</td></tr><tr><td>推理逻辑</td><td>Java/Python 实现评分系统 + 依赖图分析</td></tr><tr><td>报告生成</td><td>JSON 输出 + Web可视化（如 Vue + ECharts）</td></tr><tr><td>人工反馈</td><td>提交真实根因，记录结果</td></tr><tr><td>增量学习</td><td>基于反馈更新提示模板、归档案例库</td></tr></tbody></table><hr><p>需要我下一步帮你：</p><ul><li>编写代码实现 Top3 根因排序逻辑？</li><li>提供一套 LLM Prompt 模板进行链式推理（COT）？</li><li>构建报警传播图的推理算法设计细节？</li></ul><p>你可以选一个，我马上展开。</p><h1 id="告警出发的例子" tabindex="-1"><a class="header-anchor" href="#告警出发的例子"><span>告警出发的例子</span></a></h1><h2 id="我们来模拟一个例子" tabindex="-1"><a class="header-anchor" href="#我们来模拟一个例子"><span>我们来模拟一个例子</span></a></h2><p>假设现在我们有多个服务 service-A serivce-B serivce-C service-D 4个服务在短期内同时告警。</p><ol><li>TRACE 调用关系</li></ol><p>service-A、serivce-B、serivce-C 都依赖 service-D</p><ol start="2"><li>cmdb 基础关系</li></ol><p>service-A 依赖 mysql-A<br> service-B 依赖 mysql-B<br> service-C 依赖 mysql-C<br> service-D 依赖 mysql-D</p><p>3）变更事件</p><p>变更期间，A B C D 4个服务都发生了变更，都是普通的 propertoes 配置变更，变更风险为低</p><p>service-D 数据库进行域名切换，风险等级为中</p><p>4）告警信息</p><p>service-A、serivce-B、serivce-C 产生告警,调用 service-D rpc 超时</p><p>service-D 产生告警，访问数据库超时</p><p>给出一步步的推断过程分析报告，top3 根因</p><h2 id="gpt-回答" tabindex="-1"><a class="header-anchor" href="#gpt-回答"><span>gpt 回答</span></a></h2><p>非常好，这是一个典型的微服务场景下的根因推理问题。</p><p>你提供的信息维度非常关键，包括：</p><ul><li>Trace 调用链</li><li>CMDB 依赖关系</li><li>变更信息</li><li>告警数据</li></ul><p>我们可以利用这些信息，构建一个标准化的 <strong>根因分析流程（闭环+打分机制）</strong>，然后输出一个清晰的“Top 3 根因推理报告”。</p><hr><h2 id="🧠-根因分析过程-step-by-step" tabindex="-1"><a class="header-anchor" href="#🧠-根因分析过程-step-by-step"><span>🧠 根因分析过程（Step by Step）</span></a></h2><hr><h3 id="🔍-step-1-初步告警聚合" tabindex="-1"><a class="header-anchor" href="#🔍-step-1-初步告警聚合"><span>🔍 Step 1：初步告警聚合</span></a></h3><h4 id="📌-报警列表" tabindex="-1"><a class="header-anchor" href="#📌-报警列表"><span>📌 报警列表</span></a></h4><table><thead><tr><th>服务</th><th>报警类型</th><th>报警描述</th></tr></thead><tbody><tr><td>service-A</td><td>RPC 超时</td><td>调用 service-D 超时</td></tr><tr><td>service-B</td><td>RPC 超时</td><td>调用 service-D 超时</td></tr><tr><td>service-C</td><td>RPC 超时</td><td>调用 service-D 超时</td></tr><tr><td>service-D</td><td>数据库连接超时</td><td>无法连接 mysql-D</td></tr></tbody></table><h4 id="🧩-聚合结论" tabindex="-1"><a class="header-anchor" href="#🧩-聚合结论"><span>🧩 聚合结论：</span></a></h4><ul><li>多个服务同时异常，存在潜在的<strong>共享依赖问题</strong></li><li>service-D 被多个服务调用，可能是<strong>扇出故障热点</strong></li><li>service-D 本身也异常，优先级上升</li></ul><hr><h3 id="🛠-step-2-依赖图分析" tabindex="-1"><a class="header-anchor" href="#🛠-step-2-依赖图分析"><span>🛠 Step 2：依赖图分析</span></a></h3><p>结合 Trace + CMDB：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>service-A/B/C</span></span>
<span class="line"><span>     ↓</span></span>
<span class="line"><span>   service-D</span></span>
<span class="line"><span>     ↓</span></span>
<span class="line"><span>   mysql-D</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>🔗 service-A/B/C → service-D → mysql-D</p></blockquote><h4 id="🧠-初步图谱结论" tabindex="-1"><a class="header-anchor" href="#🧠-初步图谱结论"><span>🧠 初步图谱结论：</span></a></h4><ul><li>service-A/B/C 并非直接故障，而是调用 service-D 超时，属于 <strong>下游影响</strong></li><li>service-D 自身告警，且下探到数据库 → 需要重点关注 mysql-D</li></ul><hr><h3 id="🔁-step-3-变更数据关联" tabindex="-1"><a class="header-anchor" href="#🔁-step-3-变更数据关联"><span>🔁 Step 3：变更数据关联</span></a></h3><table><thead><tr><th>服务</th><th>变更类型</th><th>风险等级</th><th>时间点</th></tr></thead><tbody><tr><td>A/B/C/D</td><td>配置变更（低风险）</td><td>低</td><td>✔️</td></tr><tr><td>mysql-D</td><td>域名切换（中风险）</td><td>中</td><td>✔️</td></tr></tbody></table><h4 id="🎯-变更关联分析" tabindex="-1"><a class="header-anchor" href="#🎯-变更关联分析"><span>🎯 变更关联分析：</span></a></h4><ul><li>所有服务都有低风险配置变更，但这<strong>不符合异常的爆发范围和影响性</strong></li><li><strong>唯一匹配 Trace + CMDB + service-D 告警的变更是 mysql-D 域名切换</strong></li></ul><hr><h3 id="📈-step-4-根因候选项打分-统一评分机制" tabindex="-1"><a class="header-anchor" href="#📈-step-4-根因候选项打分-统一评分机制"><span>📈 Step 4：根因候选项打分（统一评分机制）</span></a></h3><p>打分维度如下：</p><table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>🔁 异常影响范围分数（Impact）</td><td>被依赖次数，传播路径长度</td></tr><tr><td>⏱ 时间关联性分数（Temporal）</td><td>告警时间是否紧随变更</td></tr><tr><td>🧠 根因合理性分数（Reasoning）</td><td>是否解释上下游所有异常</td></tr><tr><td>📉 相似历史案例（History）</td><td>是否有类似历史变更导致故障（若有知识库）</td></tr><tr><td>✅ 置信度调整项（可信度）</td><td>实例关联数越多、越靠近底层可信度越高</td></tr></tbody></table><hr><h3 id="🏅-step-5-top-3-根因推理报告" tabindex="-1"><a class="header-anchor" href="#🏅-step-5-top-3-根因推理报告"><span>🏅 Step 5：Top 3 根因推理报告</span></a></h3><table><thead><tr><th>根因候选</th><th>分析说明</th><th>打分（满分10）</th></tr></thead><tbody><tr><td>🥇 mysql-D 域名切换导致连接失败</td><td>service-D 自身报错 + A/B/C 上游全部受影响，唯一符合 Trace/CMDB/变更的事件</td><td>9.5</td></tr><tr><td>🥈 service-D 配置变更影响连接池参数</td><td>配置变更存在，但为低风险，未涉及 DB 配置项，可信度低</td><td>6.0</td></tr><tr><td>🥉 service-A/B/C 配置变更</td><td>多个服务变更，但没有解释 service-D 异常，推测为误关联</td><td>3.5</td></tr></tbody></table><hr><h2 id="📊-分析报告-可呈现在平台中" tabindex="-1"><a class="header-anchor" href="#📊-分析报告-可呈现在平台中"><span>📊 分析报告（可呈现在平台中）</span></a></h2><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">### 🧠 AI根因分析报告</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">#### 🆘 异常概况</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 多个上游服务（A/B/C）在同一时间出现调用超时</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 共用下游服务 D，且 service-D 也出现数据库连接超时告警</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">#### 🔍 系统依赖关系</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Trace 路径：A/B/C → D → mysql-D</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CMDB 配置：D 独占 mysql-D</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">#### 🔄 变更事件分析</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> D 服务所依赖的 mysql-D 刚刚进行“域名切换”，中等风险</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 告警在变更之后出现，时间强相关</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">#### ✅ 根因结论（Top 3）</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">1.</span><span style="--shiki-light:#986801;--shiki-light-font-weight:bold;--shiki-dark:#D19A66;--shiki-dark-font-weight:inherit;"> **mysql-D 域名切换导致连接失败**</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">   -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 解释所有告警路径</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">   -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 变更时间一致</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">   -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> service-D 首发告警，符合因果链条</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">   -</span><span style="--shiki-light:#986801;--shiki-light-font-weight:bold;--shiki-dark:#D19A66;--shiki-dark-font-weight:inherit;"> **评分：9.5**</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">2.</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> service-D 配置变更误操作（待进一步验证）</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">   -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 暂无明确影响指标</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">   -</span><span style="--shiki-light:#986801;--shiki-light-font-weight:bold;--shiki-dark:#D19A66;--shiki-dark-font-weight:inherit;"> **评分：6.0**</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">3.</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> A/B/C 服务自身配置变更</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">   -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 不符合 service-D 自身异常</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">   -</span><span style="--shiki-light:#986801;--shiki-light-font-weight:bold;--shiki-dark:#D19A66;--shiki-dark-font-weight:inherit;"> **评分：3.5**</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">#### 🔁 建议措施</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 回滚 mysql-D 域名切换，观察服务恢复</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 检查 service-D 的数据库连接配置（DNS、连接池）</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 标记此案例为知识样本，纳入后续 AI 训练</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="✅-关键亮点总结" tabindex="-1"><a class="header-anchor" href="#✅-关键亮点总结"><span>✅ 关键亮点总结：</span></a></h2><table><thead><tr><th>特性</th><th>实现方式</th></tr></thead><tbody><tr><td>📦 多源异构信息聚合</td><td>Trace + CMDB + 告警 + 变更</td></tr><tr><td>🔍 依赖图分析</td><td>推出上下游影响链</td></tr><tr><td>🎯 变更匹配定位</td><td>突出时间、风险、路径重叠性</td></tr><tr><td>🧠 AI打分机制</td><td>解释性 + 可信度 + 全局评估</td></tr><tr><td>🔄 闭环机制</td><td>建议动作 + 标记为样本 + 反馈优化模型</td></tr></tbody></table><hr><p>如你需要，我可以帮你把这个流程转化成：</p><ul><li>可执行的架构方案</li><li>打分引擎原型设计</li><li>NOC 流程嵌入文档</li><li>前端可视化设计草图</li></ul><p>是否要继续深入？我们可以进一步把评分引擎、反馈训练机制也详细设计出来。</p><h1 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料"><span>参考资料</span></a></h1>`,115)]))}const d=i(e,[["render",l]]),k=JSON.parse('{"path":"/posts/Note/2025-04-19-note-rca-13-ai-chat-find-rca-with-alarms.html","title":"RCA 根因分析推断-12-从告警出发，推断出根因+分析报告","lang":"zh-CN","frontmatter":{"title":"RCA 根因分析推断-12-从告警出发，推断出根因+分析报告","date":"2025-04-19T00:00:00.000Z","categories":["Note"],"tags":["note","rca","ai","devops","alarm","sh"],"published":true,"description":"序言 结合 ai 打造 rca 系统，先让 ai 回答一下。 chat 你是一名监控报警+运维的资深架构师，经验丰富，知识跨多个领域。性格严谨、理性。简单起见，我们先从一段时间内的多个报警出发，如何推断出当前问题的根因？要求 top3，并且准确性尽可能的高 非常好，从一段时间内的多个报警出发，推断当前问题的根因，这是 AI 根因分析系统中最关键、最具挑...","head":[["meta",{"property":"og:url","content":"https://houbb.github.io/blog-backend/posts/Note/2025-04-19-note-rca-13-ai-chat-find-rca-with-alarms.html"}],["meta",{"property":"og:site_name","content":"老马啸西风"}],["meta",{"property":"og:title","content":"RCA 根因分析推断-12-从告警出发，推断出根因+分析报告"}],["meta",{"property":"og:description","content":"序言 结合 ai 打造 rca 系统，先让 ai 回答一下。 chat 你是一名监控报警+运维的资深架构师，经验丰富，知识跨多个领域。性格严谨、理性。简单起见，我们先从一段时间内的多个报警出发，如何推断出当前问题的根因？要求 top3，并且准确性尽可能的高 非常好，从一段时间内的多个报警出发，推断当前问题的根因，这是 AI 根因分析系统中最关键、最具挑..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-22T03:45:14.000Z"}],["meta",{"property":"article:tag","content":"note"}],["meta",{"property":"article:tag","content":"rca"}],["meta",{"property":"article:tag","content":"ai"}],["meta",{"property":"article:tag","content":"devops"}],["meta",{"property":"article:tag","content":"alarm"}],["meta",{"property":"article:tag","content":"sh"}],["meta",{"property":"article:published_time","content":"2025-04-19T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-22T03:45:14.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"RCA 根因分析推断-12-从告警出发，推断出根因+分析报告\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-04-19T00:00:00.000Z\\",\\"dateModified\\":\\"2025-08-22T03:45:14.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"老马啸西风\\",\\"url\\":\\"https://houbb.github.io\\"}]}"]]},"git":{"createdTime":1755834314000,"updatedTime":1755834314000,"contributors":[{"name":"binbin.hou","username":"","email":"binbin.hou@huifu.com","commits":1}]},"readingTime":{"minutes":8.7,"words":2609},"filePathRelative":"posts/Note/2025-04-19-note-rca-13-ai-chat-find-rca-with-alarms.md","localizedDate":"2025年4月19日","excerpt":"\\n<p>结合 ai 打造 rca 系统，先让 ai 回答一下。</p>\\n<h1>chat</h1>\\n<h2>你是一名监控报警+运维的资深架构师，经验丰富，知识跨多个领域。性格严谨、理性。简单起见，我们先从一段时间内的多个报警出发，如何推断出当前问题的根因？要求 top3，并且准确性尽可能的高</h2>\\n<p>非常好，<strong>从一段时间内的多个报警出发，推断当前问题的根因</strong>，这是 AI 根因分析系统中最关键、最具挑战性的场景。</p>\\n<p>我会以你要求的风格：<strong>专业、理性、高准确率优先</strong>，不浮夸，强调严谨性。</p>\\n<hr>\\n<h2>🎯 场景目标</h2>","autoDesc":true}');export{d as comp,k as data};
